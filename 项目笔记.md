# 1. 核心功能

1、登录注册

2、上传音乐

3、删除某个音乐

这个删除既要删除数据库中的音乐，也要删除磁盘中的文件

4、删除选中的音乐

5、查询音乐（包含指定查询以及模糊查询）

6、添加音乐到自己喜欢的列表

7、查看自己喜欢的音乐（包含指定查询以及模糊查询）

# 2. 程序框架

# 3. 数据库设计

首先有一个歌表`music`以及用户表`user`

那么需要有什么内容呢？

对于用户，需要有**id、用户名、密码**，上面是核心的。然后可以加上年龄信息，性别，邮箱等展示其他信息

对于一首歌，它需要有`id`，歌名，作者，`url`地址，发布时间，以及`userid`。

这是的`userid`是上传者的`id`

用户可以喜欢收藏一些歌。一个人可以喜欢很多歌，一首歌可以被很多人喜欢。这是多对多的关系

```sql

-- 数据库
drop database if exists `musicserver`;
create database if not exists `musicserver` character set utf8;
-- 使用数据库
use `musicserver`;
DROP TABLE IF EXISTS `music`;
CREATE TABLE `music` (
  `id` int PRIMARY KEY  AUTO_INCREMENT,
  `title` varchar(50) NOT NULL,
  `singer` varchar(30) NOT NULL,
  `time` varchar(20) NOT NULL,
  `url` varchar(1000) NOT NULL,
  `userid` int(11) NOT NULL
);
DROP TABLE IF EXISTS `user`;
CREATE TABLE `user` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `username` varchar(20) NOT NULL,
  `password` varchar(32) NOT NULL,
  `age` INT NOT NULL,
  `gender` varchar(2) NOT NULL,
  `email` varchar(50) NOT NULL
);
DROP TABLE IF EXISTS `collection`;
CREATE TABLE `collection` (
  `id` int PRIMARY KEY  AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `music_id` int(11) NOT NULL
);
```

# 4. API约定

**登录**

```sql
请求：
POST /loginServlet
data：{username,password}
响应：
{msg: true}
```

**上传**

```sql
请求1：上传音乐到服务器目录
POST /upload

请求2：将音乐信息同步插入到数据库当中
POST /uploadsucess
```

**删除某个音乐**

```sql
请求：
POST /deleteServlet
data: {"id": id}

响应：
{msg: true}
```

**删除选中音乐信息**

```sql
请求：
POST /deleteSelMusicServlet
data:{"id":id}//id为数组
响应：
{msg: true}
```

**查询音乐**

```
请求：
POST /findLoveMusic
data:{musicName:musicName}
```

**添加音乐到喜欢列表**

```sql
请求：
POST /loveMusicServlet
data: {"id": obj}
响应：
{msg: true}
```

**查询喜欢的音乐**

```sql
请求：
POST /findLoveMusic
data:{musicName:musicName}
```

**删除喜欢的音乐**

```sql
请求：
POST /removeLoveServlet
data: {"id": obj}
```

# 5. DAO层实现及BUG-FREE

## 5.1 单例模式处理连接

由于DAO层是直接对数据库进行操作，难免要频繁进行数据库的连接断开以及资源的释放

这个专门使用一个类来处理这些情况

我们在这个类中有三个方法

```java
	private static DataSourice getDataSourice();
	public static Connection getConnection();
	public static void close();
```

上面采用单例模式-懒汉模式，需要注意线程安全

## 5.2 查找用户通过名字

函数接口

```java
	public static User findUserByName(String username)
```

通过名字查找到信息后返回一个User实例

需要注意的是：这种查找通常查找一个或者零个

本方法可以用于

登录：将按名字查找的实例密码与输入密码进行比对，相同就登录成功，否则就登录失败

注册：由于注册名字不能相同的原则，所有一旦查询到已有注册名将不能注册

## 5.3 新增用户

```java
	public static void addUser(User user)
```

直接将引用传进函数，然后进行插入操作

需要注意的是：id由系统自动生成，一般不认为设定

## 5.4 注册用户

## 5.5 添加音乐以及BUG-FREE

函数接口

```java
	public static void addMusic(String title,String singer,String time,int userId,String url)
```

BUG-FREE

最开始的函数接口是

```java
	public static void addMusic(Music music)
```

但是在添加中，无法处理数据库中时间的类型字符串型和代码Data型的bug，所以改成上面分散开写

## 5.6 删除音乐

函数接口

```java
	public static boolean deleteMusic(int id)
```

主要注意的是：只有自己上传的音乐才能执行删除，也就是说，删除人的id需要与音乐userid相同

